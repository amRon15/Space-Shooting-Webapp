<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      #control {
        margin-top: 12px;
        text-align: center;
      }

      #control button {
        width: 48px;
        height: 48px;
        touch-action: manipulation;
      }

      #board {
        display: block;
        border: 1px solid black;
        margin: 0 auto;
      }

      #images {
        display: none;
      }
    </style>
  </head>

  <body>
    <canvas id="board"></canvas>
    <div id="control">
      <button id="left">&larr;</button>
      <button id="shoot">&cir;</button>
      <button id="right">&rarr;</button>
    </div>
    <script>
      let frame = 0;

      /* Canvas */
      const canvas = document.querySelector("#board");
      canvas.width = 200;
      canvas.height = 300;
      const context = canvas.getContext("2d");

      /* Player */
      const playerW = 64;
      const playerH = 64;
      let playerX = canvas.width / 2 - playerW / 2;
      let playerY = canvas.height - playerH;
      const playerSpeed = 10;
      const playerImage = new Image();
      playerImage.src = "/shooter/spaceship.png";
      let index = 0;

      /* Bullet */
      let bulletX;
      let bulletY;
      const bulletW = 16;
      const bulletH = 16;
      const bulletSpeed = 10;
      let bulletVisible = false;
      const bulletImage = new Image();
      bulletImage.src = "/shooter/bullet.png";

      /* Water */
      let bgY = 0;
      const bgImage = new Image();
      bgImage.src = "/shooter/SpaceBg.png";

      function update() {
        /* Water */
        if (bgY < canvas.height) {
          bgY++;
        } else {
          bgY = 0;
        }
        context.drawImage(bgImage, 0, bgY);
        context.drawImage(bgImage, 0, bgY - canvas.height);

        /* Bullet */
        if (bulletVisible) {
          bulletY -= bulletSpeed;
          if (bulletY < 0 - bulletH) {
            bulletVisible = false;
          }
          context.drawImage(bulletImage, bulletX, bulletY);
        }

        /* Player */

        context.drawImage(
          playerImage,
          playerW,
          0,
          playerW,
          playerH,
          playerX,
          playerY,
          playerW,
          playerH
        );

        frame = requestAnimationFrame(update);
      }

      function handleInput() {
        window.addEventListener("keydown", function (event) {
          switch (event.key) {
            case "ArrowLeft":
              left();
              break;
            case "ArrowRight":
              right();
              break;
            case " ":
              shoot();
              break;
          }
        });
        document.querySelector("#left").onclick = function () {
          left();
        };
        document.querySelector("#right").onclick = function () {
          right();
        };
        document.querySelector("#shoot").onclick = function () {
          shoot();
        };
      }

      function left() {
        playerX -= playerSpeed;
        if (playerX < 0) playerX = 0;
      }

      function right() {
        playerX += playerSpeed;
        if (playerX + playerW > canvas.width) playerX = canvas.width - playerW;
      }

      function shoot() {
        if (!bulletVisible) {
          bulletX = playerX + playerW / 2 - bulletW / 2;
          bulletY = playerY;
          bulletVisible = true;
        }
      }

      window.addEventListener("load", () => {
        handleInput();
        update();
      });
    </script>
  </body>
</html>
